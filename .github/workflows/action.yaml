name: Main Workflow Terraform

on:
  push:
    branches:
      - main

jobs:
  determine_workflow:
    runs-on: ubuntu-latest
    steps:
      - name: Determine Workflow
        id: check_commit
        run: echo ::set-output name=DESTROY::$(if echo "${{ github.event.head_commit.message }}" | grep -q "\[destroy\]"; then echo "true"; else echo "false"; fi)

  trigger_destroy_workflow:
    runs-on: ubuntu-latest
    needs: [determine_workflow]
    if: steps.determine_workflow.outputs.DESTROY == 'true'
    steps:
      - name: Trigger Destroy Workflow
        uses: peter-evans/workflow-dispatch@v1
        with:
          workflow: Destroy Workflow
